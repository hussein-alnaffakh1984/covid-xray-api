<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>COVID X-ray Classifier</title>
  <style>
    body { font-family: Arial, Tahoma, sans-serif; background:#f6f7fb; margin:0; }
    .wrap { max-width: 900px; margin: 30px auto; padding: 16px; }
    .card { background:#fff; border-radius:14px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.06); }
    .header { display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .title { font-size:28px; margin:0; color:#111; }
    .meta { margin-top:8px; line-height:1.9; color:#222; font-size:16px; }
    .logo { width:110px; height:auto; }
    .row { display:flex; gap:14px; flex-wrap:wrap; margin-top:18px; }
    .col { flex:1; min-width:260px; }
    input[type=file], input[type=number] { width:100%; padding:10px; border:1px solid #ddd; border-radius:10px; font-size:16px; }
    button { width:100%; padding:12px; border:0; border-radius:10px; font-size:16px; cursor:pointer; }
    .btn { background:#111; color:#fff; }
    .btn2 { background:#2f6fed; color:#fff; }
    .hint { color:#666; font-size:14px; margin-top:8px; }
    .result { margin-top:16px; padding:14px; border-radius:12px; background:#f2f7ff; border:1px solid #d9e7ff; }
    .badge { display:inline-block; padding:6px 10px; border-radius:999px; font-weight:bold; }
    .covid { background:#ffe8e8; color:#a60000; }
    .normal { background:#e8fff0; color:#007a2f; }
    .footer { margin-top:14px; color:#666; font-size:13px; }
    .center { text-align:center; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <div>
          <h1 class="title">COVID X-ray Classification (MobileNetV2)</h1>
          <div class="meta">
            <div><b>الجامعة:</b> جامعة الكفيل</div>
            <div><b>الكلية:</b> كلية التقنيات الصحية والطبية</div>
            <div><b>القسم:</b> قسم الأشعة</div>
            <div><b>المرحلة:</b> الرابعة</div>
          </div>
        </div>
        <img class="logo" src="/static/logo.png" alt="College Logo" />
      </div>

      <hr style="border:none;border-top:1px solid #eee; margin:18px 0;">

      <form action="/ui" method="post" enctype="multipart/form-data">
        <div class="row">
          <div class="col">
            <label><b>ارفع صورة الأشعة (JPG/PNG)</b></label>
            <input name="file" type="file" accept=".jpg,.jpeg,.png" required />
            <div class="hint">يفضل صورة واضحة للصدر (Chest X-ray).</div>
          </div>
          <div class="col">
            <label><b>Threshold (العتبة)</b></label>
            <input name="threshold" type="number" step="0.05" min="0.1" max="0.9" value="0.5" />
            <div class="hint">افتراضي 0.5</div>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <button class="btn" type="submit">تشخيص الصورة</button>
          </div>
          <div class="col">
            <a href="/api-docs" style="text-decoration:none;">
              <button class="btn2" type="button">واجهة الـ API (اختياري)</button>
            </a>
          </div>
        </div>
      </form>

      {% if result %}
      <div class="result">

        <h3>صورة الأشعة التي تم تحليلها:</h3>
        <div class="center">
          <img src="{{ result.image_src }}"
               style="max-width:100%; max-height:420px; border-radius:12px; border:1px solid #ddd;" />
        </div>

        <hr style="margin:16px 0;">

        <div class="center">
          <span class="badge {{ 'covid' if result.prediction=='COVID' else 'normal' }}">
            النتيجة: {{ result.prediction }}
          </span>
        </div>

        <p><b>Confidence:</b> {{ "%.2f"|format(result.confidence_percent) }}%</p>
        <p><b>Raw sigmoid P(label=1):</b> {{ "%.4f"|format(result.raw_sigmoid_p_label1) }}</p>

        <div class="row">
          <div class="col">
            <a href="/report-page" style="text-decoration:none;">
              <button class="btn2" type="button">تحميل تقرير PDF</button>
            </a>
          </div>
        </div>

        <div class="footer">
          ملاحظة: هذا النظام لأغراض تعليمية/بحثية ولا يُعد بديلاً عن تشخيص الطبيب.
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</body>
</html>
